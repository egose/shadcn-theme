<ng-template #menuIconTemplate>
  <ng-icon [svg]="menuIcon" size="20px" class="tw:[&_svg]:w-[inherit]! tw:[&_svg]:h-[inherit]!" />
</ng-template>

<eg-layout-simple-sidebar
  [title]="sidebarTitle()"
  [content]="sidebarContent()"
  [contentContext]="{ close: closeSidebar.bind(this) }"
/>

<div class="tw:flex tw:flex-col tw:min-h-screen">
  <!-- Header -->
  <header [class]="_headerClass()">
    <div class="tw:flex tw:items-center tw:space-x-4">
      @if (sidebarEnabled()) {
        <button
          hlmButton
          variant="secondary"
          appearance="outline"
          size="icon"
          [icon]="menuIconTemplate"
          iconPosition="left"
          class="tw:bg-transparent! tw:border-gray-400! tw:hover:border-gray-500!"
          (click)="openSidebar()"
        ></button>
      }

      <div class="logo">
        <a [routerLink]="logoLink()">
          <img [src]="logo()" alt="Logo" [class]="_logoClass()" />
        </a>
      </div>
      <!-- Left menus (desktop) -->
      <nav [class]="_computedLeftClass()">
        @for (item of leftMenus(); track item.label) {
          @if (item.link) {
            <a [routerLink]="item.link" [class]="hlm(_computedLeftLinkClass(), item.class || '')"> {{ item.label }} </a>
          } @else {
            <button type="button" (click)="item.action?.()" [class]="hlm(_computedLeftLinkClass(), item.class || '')">
              {{ item.label }}
            </button>
          }
        }
      </nav>
    </div>

    <!-- Right menus (desktop) -->
    <nav [class]="_computedRightClass()">
      @if (searchEnabled()) {
        <eg-generic-autocomplete
          [optionTemplate]="searchOptionTemplate()"
          [loaderFn]="searchLoaderFn()"
          [transformValueToSearch]="searchTransformValueToSearch()"
          [placeholderText]="searchPlaceholderText()"
          [emptyText]="searchEmptyText()"
          (optionChange)="onSearchOptionChange($event)"
        ></eg-generic-autocomplete>
      }

      @for (item of rightMenus(); track item.label) {
        @if (item.link) {
          <a [routerLink]="item.link" [class]="hlm(_computedRightLinkClass(), item.class || '')"> {{ item.label }} </a>
        } @else {
          <button type="button" (click)="item.action?.()" [class]="hlm(_computedRightLinkClass(), item.class || '')">
            {{ item.label }}
          </button>
        }
      }

      @let uMenus = userMenus();
      @if (uMenus && uMenus.length > 0) {
        <eg-layout-simple-user-menu [menus]="uMenus"></eg-layout-simple-user-menu>
      }
    </nav>

    <!-- Mobile menu button -->
    <button
      (click)="toggleMobileMenu()"
      class="tw:md:hidden tw:p-2 tw:text-gray-700 tw:hover:text-primary tw:focus:outline-none tw:cursor-pointer"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="tw:h-6 tw:w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </header>

  @let _topMenus = leftMenus().concat(rightMenus());
  @let _userMenus = userMenus();

  <!-- Mobile menu -->
  @if (isMobile() && mobileMenuOpen) {
    <hlm-menu class="tw:w-full tw:border-none">
      <eg-layout-simple-mobile-menu-group [items]="_topMenus"></eg-layout-simple-mobile-menu-group>

      @if (_topMenus.length > 0 && _userMenus.length > 0) {
        <hr class="tw:border-gray-300 tw:my-2" />
      }

      @for (section of userMenus(); track section.label) {
        <eg-layout-simple-mobile-menu-group
          [items]="section.items"
          [label]="section.label"
        ></eg-layout-simple-mobile-menu-group>

        @if (section.separator) {
          <hr class="tw:border-gray-300 tw:my-2" />
        }
      }
    </hlm-menu>
  }

  <!-- Main content -->
  <main [class]="_contentClass()">
    @if (!loading()) {
      <div class="tw:flex tw:items-center tw:justify-center tw:h-full">
        <ng-content />
      </div>
    }
    <div [class]="_contentBottomClass()"></div>
  </main>

  @if (footerEnabled()) {
    <footer [class]="_footerClass()">
      <nav [class]="_computedFooterMenuClass()">
        @for (item of footerMenus(); track item.label) {
          @if (item.link) {
            <a [routerLink]="item.link" [class]="hlm(_computedFooterLinkClass(), item.class || '')">
              {{ item.label }}
            </a>
          } @else {
            <button type="button" (click)="item.action?.()" [class]="hlm(_computedFooterLinkClass(), item.class || '')">
              {{ item.label }}
            </button>
          }
        }
      </nav>

      <div class="tw:mt-2 tw:text-center">
        {{ footerContent() }}
      </div>
    </footer>
  }
</div>
